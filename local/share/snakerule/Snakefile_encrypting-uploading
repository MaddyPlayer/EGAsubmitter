include: "../snakemake/conf_encrypting-uploading.sk"

# """
# rule all:
#     input: "snakemake.done"

# rule environ:
#     output: touch("snakemake.done")
#     run:
#         import os
#         print("User login: " + EGA_USER + " " + EGA_PWD)

# """

rule all:
    input: LOGS+"/crypted/ega_cryptor_{sample}.log"
    shell:
        """
            echo "All the files have been encrypted and transferred!"
        """

checkpoint paths:
    input: CSV+"/Samples_Informations.csv"
    output: samples=CSV+"/All_files-names.txt", paths=CSV+"/All_paths.txt"
    script: SRC_DIR+"/getPaths.R"

# rule all_creypted:
#     input: getNames
#     output: LOGS+"/done/AllCrypted.done"
#     shell:
#         """
#             touch {output.done}
#             echo "All files have been crypted"
#         """
rule ega_cryptor:
    input: getPaths, lambda wildcards: PATHS[wildcards.sample]
    output: OUTPUT_PATH+"/{sample}.gpg", 
            OUTPUT_PATH+"/{sample}.gpg.md5",
            OUTPUT_PATH+"/{sample}.md5",
    params: tool=EGA_CRYPTOR, outdir=OUTPUT_PATH, threads=10
    log: LOGS+"/crypted/ega_cryptor_{sample}.log"
    shell:
        """
            java -jar {params.tool} -i {input} -o {params.outdir} -t {params.threads} 2> {log}
        """

### separare input da virgola e poi splittare nel .py per riottenere la lista
### Use ftp transfer through python
# rule file_transfer:
#     input: getNames
#     output: touch(DONE+"/file_transfer.done")
#     params: user=EGA_USER, pwd=EGA_PWD, tool=FTP_TRANSFER, ega_box=EGA_BOX
#     log: LOGS + "/file_transfer.log"
#     shell:
#         """
#             python3 {params.tool} -i {input} -c {params.ega_box} -u {params.user} -p {params.pwd} 2> {log}
#         """

# touch(DONE+"/file_transfer-{dataset}_{sample}.done"),
