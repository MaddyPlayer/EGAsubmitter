include: "../snakemake/conf_encrypting-uploading.sk"

rule all:
    input: expand(DONE+"/filesTransferred-{dataset}.done", dataset=PROJECT_NAME)
    output: DONE+"/encrypted-upload.done"
    shell:
        """
            touch {output}
            echo "All the files have been encrypted and transferred!"
        """

rule file_transfer_recovery:
    input:  filesList=CSV+"/All_files-names.txt", done=DONE+"/filesCrypted.done"
    output: touch(DONE+"/filesTransferred-{dataset}.done")
    params: user=EGA_USER, pwd=EGA_PWD, tool=FTP_TRANSFER, ega_box=EGA_BOX
    log: LOGS+"/filesTransferred-{dataset}.log"
    shell:
        """
            while read line; do
                python3 {params.tool} -i $line -c {params.ega_box} -u {params.user} -p {params.pwd} --recovery 2>> {log}
            done < {input.filesList}
        """
